{{ansible_managed|comment(decoration='#')}}

{% if (openssh_state is match('start|on|enable')) %}
check process openssh with pidfile "/var/run/sshd.pid"
  start program = "/usr/sbin/rcctl start {{service_name_openssh}}"
  stop program = "/usr/sbin/rcctl stop {{service_name_openssh}}"
{% if not (openssh_port == []) %}
{% for item in openssh_port %}
  if failed host 127.0.0.1 port {{(item|int(22))}} type tcp protocol ssh with timeout 10 seconds then alert
{% endfor %}
{% else %}
  if failed host 127.0.0.1 port 22 type tcp protocol ssh with timeout 10 seconds then alert
{% endif %}
  if 5 restarts within 5 cycles then unmonitor
{% endif %}
